#!/bin/bash

set -e

git clone https://github.com/ohmyzsh/ohmyzsh.git /etc/skel/.oh-my-zsh

#Copying default profile on /etc/skel
cp -arf /usr/share/kaisen-skeleton/{.config,.face,.face.icon,.bashrc,.zshrc,.local,.kde,.gtkrc-2.0,Desktop,.conkyrc} /etc/skel
rm -rf /usr/share/kaisen-skeleton

if [[ -z "$2" ]]; then

#Installation of default profile for all users only when package is installed and define ZSH as default shell for all standard users
for users in $(awk -F: '/\/home/ {printf "%s:%s\n",$1,$3}' /etc/passwd | cut -d: -f1)
do
        cp -arf /etc/skel/{.config,.face,.face.icon,.local,.bashrc,.zshrc,.kde,.gtkrc-2.0,Desktop,.conkyrc,.oh-my-zsh} /home/$users && chown -R $users: /home/$users
	chsh -s /bin/zsh $users
done

cp -arf /etc/skel/{.config,.face,.face.icon,.local,.bashrc,.zshrc,.kde,.gtkrc-2.0,.oh-my-zsh,.conkyrc} /root

fi

#Automatic update conkyrc for all users
for users in $(awk -F: '/\/home/ {printf "%s:%s\n",$1,$3}' /etc/passwd | cut -d: -f1)
do
	if [[ -e /home/$users/.conkyrc ]]; then
        cp -f /etc/skel/.conkyrc /home/$users/
        cp -f /etc/skel/.conkyrc /root/
	fi
done

#DEBHELPER#
